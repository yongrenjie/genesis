<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Jonathan Yong">
    <meta name="description" content="Website to automatically generate NOAH pulse programmes in Bruker format">
    <link rel="icon" href="data:,"><!-- stops Chrome from asking for a favicon -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400;1,700&display=auto" rel="stylesheet">
    <title>gennoah</title>
</head>

<link rel="stylesheet" type="text/css" href="css/main.css">
<link rel="stylesheet" type="text/css" href="css/modules.css">
<link rel="stylesheet" type="text/css" href="css/buttons.css">

<body>

    <h1>NOAH pulse programme generator</h1>

    <div id="spinner-container">
        <div id="spinner-text">Loading modules... </div>
        <div id="spinner-symbol"><div id="spinner"></div></div>
    </div>

    <div id="wrapper">

        <main role="main">

            <div id="main-container">

                <div id="chooser-container">

                    <h2>Module selector</h2>
                    <div id="chooser">

                        <div class="chooser_text hmbc">
                            <sup>13</sup>C HMBC
                        </div>
                        <div class="chooser_modules hmbc">
                            <ul>
                                <!-- nondevmode -->
                                <li>
                                    <input type="radio" name="hmbc" id="hmbc_none" checked></input>
                                    <label for="hmbc_none">None</label>
                                </li>
                                <li>
                                    <input type="radio" name="hmbc" id="hmbc_hmbc"></input>
                                    <label for="hmbc_hmbc">HMBC</label>
                                </li>
                                <li>
                                    <input type="radio" name="hmbc" id="C_HMBC_CNF"></input>
                                    <label for="C_HMBC_CNF">C_HMBC_CNF</label>
                                </li>
                                <li>
                                    <input type="radio" name="hmbc" id="C_HMBC_CF"></input>
                                    <label for="C_HMBC_CF">C_HMBC_CF</label>
                                </li>
                                <li>
                                    <input type="radio" name="hmbc" id="C_HMBC_NOF"></input>
                                    <label for="C_HMBC_NOF">C_HMBC_NOF</label>
                                </li>
                            </ul>
                        </div>

                        <div class="chooser_text n15">
                            <sup>15</sup>N–<sup>1</sup>H
                        </div>
                        <div class="chooser_modules n15">
                            <ul>
                                <!-- nondevmode -->
                                <li>
                                    <input type="radio" name="n15" id="n15_none" checked></input>
                                    <label for="n15_none">None</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="n15_hmqc"></input>
                                    <label for="n15_hmqc">HMQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="n15_hsqc"></input>
                                    <label for="n15_hsqc">HSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="n15_sehsqc"></input>
                                    <label for="n15_sehsqc">seHSQC</label>
                                </li>
                                <!-- devmode -->
                                <li>
                                    <input type="radio" name="n15" id="N_HMQC"></input>
                                    <label for="N_HMQC">N_HMQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="N_HSQC"></input>
                                    <label for="N_HSQC">N_HSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="N_SEHSQC"></input>
                                    <label for="N_SEHSQC">N_SEHSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="N_SEHSQC_OR"></input>
                                    <label for="N_SEHSQC_OR">N_SEHSQC_OR</label>
                                </li>
                                <li>
                                    <input type="radio" name="n15" id="N_SEHSQC_DP"></input>
                                    <label for="N_SEHSQC_DP">N_SEHSQC_DP</label>
                                </li>
                            </ul>
                        </div>

                        <div class="chooser_text hsqct">
                            <sup>13</sup>C HSQC-TOCSY
                        </div>
                        <div class="chooser_modules hsqct">
                            <ul>
                                <!-- nondevmode -->
                                <li>
                                    <input type="radio" name="hsqct" id="hsqct_none" checked></input>
                                    <label for="hsqct_none">None</label>
                                </li>
                                <li>
                                    <input type="radio" name="hsqct" id="hsqct_hsqct"></input>
                                    <label for="hsqct_hsqct">HSQC-TOCSY</label>
                                </li>
                                <!-- devmode -->
                                <li>
                                    <input type="radio" name="hsqct" id="HSQCT_INEPT"></input>
                                    <label for="HSQCT_INEPT">HSQCT_INEPT</label>
                                </li>
                                <li>
                                    <input type="radio" name="hsqct" id="HSQCT_HSQCT"></input>
                                    <label for="HSQCT_HSQCT">HSQCT_HSQCT</label>
                                </li>
                                <li>
                                    <input type="radio" name="hsqct" id="HSQCT_OR"></input>
                                    <label for="HSQCT_OR">HSQCT_OR</label>
                                </li>
                                <li>
                                    <input type="radio" name="hsqct" id="HSQCT_HSQC"></input>
                                    <label for="HSQCT_HSQC">HSQCT_HSQC</label>
                                </li>
                            </ul>
                        </div>

                        <div class="chooser_text c13">
                            <sup>13</sup>C–<sup>1</sup>H
                        </div>
                        <div class="chooser_modules c13">
                            <ul>
                                <!-- nondevmode -->
                                <li>
                                    <input type="radio" name="c13" id="c13_none" checked></input>
                                    <label for="c13_none">None</label>
                                </li>
                                <li>
                                    <input type="radio" name="c13" id="c13_hsqc"></input>
                                    <label for="c13_hsqc">HSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="c13" id="c13_sehsqc"></input>
                                    <label for="c13_sehsqc">seHSQC</label>
                                </li>
                                <!-- devmode -->
                                <li>
                                    <input type="radio" name="c13" id="C_HSQC"></input>
                                    <label for="C_HSQC">C_HSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="c13" id="C_SEHSQC"></input>
                                    <label for="C_SEHSQC">C_SEHSQC</label>
                                </li>
                                <li>
                                    <input type="radio" name="c13" id="C_SEHSQC_OR"></input>
                                    <label for="C_SEHSQC_OR">C_SEHSQC_OR</label>
                                </li>
                                <li>
                                    <input type="radio" name="c13" id="C_SEHSQC_DP"></input>
                                    <label for="C_SEHSQC_DP">C_SEHSQC_DP</label>
                                </li>
                            </ul>
                        </div>

                        <div class="chooser_text h1">
                            <sup>1</sup>H–<sup>1</sup>H
                        </div>
                        <div class="chooser_modules h1">
                            <!-- it is very important, when adding future modules here, that
                                the input id (and the label for-attribute) is h1_xxx_xxx and
                                corresponds EXACTLY to the backend module file which should be
                                H_XXX_XXX.js. -->
                            <ul>
                                <li id="li_h1_none">
                                    <input type="radio" name="h1" id="h1_none" checked></input>
                                    <label for="h1_none">None</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_cosy"></input>
                                    <label for="h1_cosy">COSY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_cosy_qf"></input>
                                    <label for="h1_cosy_qf">COSY (QF)</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_clip_cosy"></input>
                                    <label for="h1_clip_cosy">CLIP-COSY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_dqf_cosy"></input>
                                    <label for="h1_dqf_cosy">DQF-COSY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_tocsy"></input>
                                    <label for="h1_tocsy">TOCSY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_noesy"></input>
                                    <label for="h1_noesy">NOESY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_roesy"></input>
                                    <label for="h1_roesy">ROESY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_roesy_ad"></input>
                                    <label for="h1_roesy_ad">ROESY (ad.)</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_cosy_tocsy"></input>
                                    <label for="h1_cosy_tocsy">COSY + TOCSY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_cosy_noesy"></input>
                                    <label for="h1_cosy_noesy">COSY + NOESY</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_jres"></input>
                                    <label for="h1_jres">2DJ (QF)</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_psyche_jres"></input>
                                    <label for="h1_psyche_jres">PSYCHE 2DJ</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_psyche"></input>
                                    <label for="h1_psyche">1D PSYCHE</label>
                                </li>
                                <li>
                                    <input type="radio" name="h1" id="h1_tse_psyche"></input>
                                    <label for="h1_tse_psyche">1D TSE-PSYCHE</label>
                                </li>
                            </ul>
                        </div>

                    </div><!-- /chooser -->
                </div><!-- /chooser-container -->


                <div id="button-container">
                    <div></div>
                    <div id="buttons">
                        <input id="reset_button" type="button" value="Reset all">
                        <input id="download_button" type="button" value="Download pulse programme">
                        <input id="faq_button" type="button" value="Read the FAQ">
                    </div>
                    <div id="devmode">
                        Developer mode:
                        <div class="switch">
                            <input id="devmode_button" type="checkbox" class="switch-input" />
                            <label for="devmode_button" class="switch-label"></label>
                        </div>
                    </div>
                </div><!-- /button-container -->


                <div id="pulprog">
                    <h2>Pulse programme text</h2>
                    <textarea id="pulprog_text" rows=40 placeholder="Select two or more modules to generate pulse programme..." readonly></textarea>
                </div>

                <div id="faq">
                    <h2>FAQ</h2>

                    <ul id="faq_toc">
                    </ul>

                    <dl>

                        <dt id="faq_run">How do I run a NOAH experiment?</dt>
                        <dd>
                            <p>For the most part the setup is the same as for a standard 2D experiment. The nuclei involved should be configured in the same way as for a <sup>13</sup>C–<sup>1</sup>H experiment. There are two parameters which require additional consideration:</p>
                            <ul>
                                <li><b>NBL</b> should be set to the total number of modules, e.g. 4 for a MSCN supersequence. (Set this either in <span class="ms">ased</span>, or by typing <span class="ms">nbl</span> into the TopSpin command line.)</li>
                                <li><b>TD1</b> (i.e. TD in the F1 dimension) must be its original value multiplied by the total number of modules. For example, if you are running a supersequence with 4 modules and want to have 256 <i>t</i><sub>1</sub> increments in each module, TD1 must be set to 256 × 4 = 1024.</li>
                            </ul>

                            <p>If the sequence involves a <sup>15</sup>N module, then you must also set <b>cnst40</b>, which is the SW for the <sup>15</sup>N experiment (in ppm). On older versions of NOAH pulse programmes you may have needed to manually calculate a cnst20 ratio for <sup>15</sup>N experiments — <i>this is no longer necessary.</i></p>
                        </dd>

                        <dt id="faq_rga">Does rga work as expected?</dt>
                        <dd>
                            <p>No, it doesn't. It tries to optimise the receiver gain for the first module, instead of the entire supersequence as a whole. If the first module has low intrinsic sensitivity (which is typically the case), then <span class="ms">rga</span> will suggest unreasonably large values for the receiver gain, leading to ADC overflows for the more sensitive modules.</p>

                            <p>If you want to use <span class="ms">rga</span>, you will need to run it with a different pulse programme which corresponds to the most sensitive module. For example, for a MSCN supersequence, you should run <span class="ms">rga</span> with the pulse programme set to a COSY.</p>

                            <p>Alternatively, instead of simply acquiring with <span class="ms">zg</span>, you can run <span class="ms">au_zgcosy</span>. This performs <span class="ms">rga</span> on a pulse-acquire sequence before acquiring the actual data.
                        </dd>

                        <dt id="faq_weird">During acquisition, is it normal that TopSpin shows weird numbers in the progress bar?</dt>
                        <dd>
                            <p>Yes. Using the same example as before, if you are running a NOAH-4 experiment with 256 <i>t</i><sub>1</sub> increments (i.e. TD1 = 1024), then the progress line in the status bar will inch towards "1024/256".</p>
                        </dd>

                        <dt id="faq_process">How do I process the acquired data?</dt>
                        <dd>

                            <p>If you acquired this data under automation, it should have already been set up such that your data is automatically processed. If your NOAH dataset was acquired with experiment number (expno) <i>m</i>, then check whether you already have datasets in expnos 1000<i>m</i> + 1 onwards. If those exist, then chances are these <i>are</i> the individual processed 2D spectra. If not, then read on...</p>

                            <ol class="steps">
                                <li>
                                    <p>Make sure you have the appropriate AU programmes on your TopSpin installation.</p>
                                    <p>A number of them already come installed with TopSpin. The newest versions, or any missing ones, can always be downloaded from here. [LINK TO BE ADDED]. Simply unzip that and copy everything into the folder <b>your_TopSpin_installation/exp/stan/nmr/au/src/user</b>. On Windows you can typically find the TopSpin installation in <span class="ms">C:\Bruker\TopSpinX.Y.Z</span>; on macOS/Linux it's <span class="ms">/opt/topspinx.y.z</span>.</p>
                                </li>

                                <li>
                                    <p>Set up the 'user processing parameters' USERP1 through USERP5, according to the modules that were used.</p>

                                    <p>If you used the pulse sequences generated by this website, as well as the newest versions of the AU programmes linked above, <b>this step can be skipped entirely</b> as it is automated.</p>

                                    <p>Anyway, if you happened to use an old version (or want to overrule the automated choices, for whatever reason), these parameters can be accessed near the bottom of the TopSpin processing parameters (type <span class="ms">edp</span>). Set the values according to the following list. For example, if you ran a BSCN experiment, then USERP1 through USERP4 should be set to <span class="ms">noah_hmbc</span>, <span class="ms">noah_hsqc</span>, <span class="ms">noah_cosy</span>, and <span class="ms">noah_noesy</span> respectively. USERP5 can be left blank.</p>

                                    <ul>
                                        <li><span class="ms">noah_hmbc</span> for a <b>HMBC</b> module;</li>
                                        <li><span class="ms">noah_hmqc</span> for a <b><sup>15</sup>N HMQC</b> module;</li>
                                        <li><span class="ms">noah_nhsqc</span> for a <b><sup>15</sup>N HSQC</b> module;</li>
                                        <li><span class="ms">noah_hsqc</span> for a <b><sup>13</sup>C HSQC</b> module;</li>
                                        <li><span class="ms">noah_cosy</span> for a <b>phase-sensitive COSY</b> module;</li>
                                        <li><span class="ms">noah_cosy QF</span> for a <b>magnitude-mode COSY</b> module;</li>
                                        <li><span class="ms">noah_clipcosy States</span> for a <b>CLIP-COSY</b> module;</li>
                                        <li><span class="ms">noah_noesy States</span> for a <b>NOESY</b> module;</li>
                                        <li><span class="ms">noah_roesy States</span> for a <b>ROESY</b> module;</li>
                                        <li><span class="ms">noah_tocsy States</span> for a <b>TOCSY</b> module.</li>
                                    </ul>
                                </li>

                                <li>
                                    <p>Process the data by entering <span class="ms">splitx_au</span> into the TopSpin command-line.</p>
                                    <p>This will create new datasets with experiment numbers (expnos) beginning from 1000<i>m</i> + 1, where <i>m</i> is the expno of the original NOAH data.</p>
                                    <p>If you are using macOS 10.15 (Catalina), please note there is a bug in TopSpin which causes a number of AU programmes to not work. On TopSpin 4.0.9, <span class="ms">splitx_au</span> will still work but many of the subsidiary AU programmes do not (especially those for <sup>15</sup>N or <sup>1</sup>H modules). On earlier versions, even <span class="ms">splitx_au</span> itself will not work. Unfortunately there is nothing we can do about it until Bruker releases a fix.</p>
                                </li>
                            </ol>
                        </dd>

                        <dt id="faq_nus">How do I use non-uniform sampling with NOAH sequences?</dt>
                        <dd>
                            <p>NUS can be enabled in the pulse sequence, but <b>not</b> in the conventional way of setting FnTYPE to 'non-uniform sampling'.</p>

                            <p>The steps below are applicable to all pulse programmes downloaded from this website.</p>

                            <ol>
                                <li>Get the newest version of <span class="ms">noah_nus.py</span> from here.</li>

                                <li>Set up your experiment normally without NUS first, with the full value for TD1. Don't change any other parameters, such as FnTYPE. (Actually, the script will change this back if you do change it.)</li>

                                <li>Specify the parameter NUSAmount and then run <span class="ms">noah_nus</span>.</li>

                                <li>To disable NUS on a dataset where it was previously enabled, run <span class="ms">noah_nus off</span>.</li>
                            </ol>

                            <p>Please note that NUS is not currently compatible with the <i>k</i>-scaling in <sup>15</sup>N modules. If you set up an experiment with cnst39 &gt; 1 and then enable NUS, cnst39 will be changed back to 1. (In principle this can be overcome, but it would add several more layers of complexity for the user.)</p>
                        </dd>

                        <dt id="faq_automation">How can NOAH spectra be set up for use in automation?</dt>
                        <dd>
                            <p>The acquisition AU programme (AUNM) should be set to <span class="ms">au_zgcosy</span>, to avoid issues with <span class="ms">rga</span> (see above). The processing AU programme (AUNMP) should be set to <span class="ms">splitx_au</span>. If the pulse programmes and AU scripts are up-to-date, then there is no need to set the user processing parameters.</p>

                            <p>WaveMaker shaped pulses can optionally be generated before acquisition by adding the statement <span class="ms">XCMD("wvm -q")</span> into the acquisition AU programme.</p>
                        </dd>

                        <dt id="faq_cite">What papers should I cite / where can I find out more about NOAH experiments?</dt>
                        <dd>
                            <p>Thanks for asking. There are a few:</p>
                            
                            <ol id="citations">
                                <li>Kupče, Ē.; Claridge, T. D. W. NOAH: NMR Supersequences for Small Molecule Analysis and Structure Elucidation. <i>Angew. Chem. Int. Ed.</i> <b>2017,</b> <i>56</i> (39), 11779–11783. <a href="https://doi.org/10.1002/anie.201705506">DOI: 10.1002/anie.201705506</a>.</li>
                                <li>Kupče, Ē.; Claridge, T. D. W. Molecular structure from a single NMR supersequence. <i>Chem. Commun.</i> <b>2018,</b> <i>54</i> (52), 7139–7142. <a href="https://doi.org/10.1039/C8CC03296C">DOI: 10.1039/C8CC03296C</a>.</li>
                                <li>Claridge, T. D. W.; Mayzel, M.; Kupče, Ē. Triplet NOAH supersequences optimised for small molecule structure characterisation. <i>Magn. Reson. Chem.</i> <b>2019,</b> <i>57</i> (11), 946–952. <a href="https://doi.org/10.1002/mrc.4887">DOI: 10.1002/mrc.4887</a>.</li>
                                <li>Kupče, Ē.; Claridge, T. D. W. New NOAH modules for structure elucidation at natural isotopic abundance. <i>J. Magn. Reson.</i> <b>2019,</b> <i>307,</i> 106568. <a href="https://doi.org/10.1016/j.jmr.2019.106568">DOI: 10.1016/j.jmr.2019.106568</a>.</li>
                            </ol>

                            In terms of citations, it would be nice to cite at least [1], which is the main article. If you're using some HMBC + HSQC + COSY combination for characterisation of organic molecules, then [3] will also be relevant. The other papers are slightly more niche.
                        </dd>
                        
                    </dl>
                </div><!-- /faq -->

            </div><!-- /main-container -->

        </main>
    </div><!-- /wrapper -->


    <script src="pulprog.js" type="module"></script>
    <script src="faq.js" type="module"></script>

</body>
</html>
